<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="style-src 'self' 'nonce-{{.Nonce}}' https://cdn.jsdelivr.net;
                 script-src 'nonce-{{.Nonce}}' https://cdn.jsdelivr.net;
                 font-src 'self';" />
    <title>Snyk Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" nonce="{{.Nonce}}">
    <style nonce="{{.Nonce}}">
        {{.Styles}}
    </style>
</head>
<body>
    <form id="configForm">
        <!-- Row 1: Scan Configuration and Filtering -->
        <div class="row">
            <div class="col-md-6">
                <div class="section">
                    <h2>Scan Configuration</h2>

                    <div class="form-group">
                        <h3>Snyk Products</h3>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="activateSnykOpenSource" {{if eq .Settings.ActivateSnykOpenSource "true"}}checked{{end}}>
                                Activate Snyk Open Source
                                <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Find and fix open source dependency issues">?</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="activateSnykCode" {{if eq .Settings.ActivateSnykCode "true"}}checked{{end}}>
                                Activate Snyk Code
                                <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Find and fix security issues in your application code in real time. Note: Snyk Code must be enabled for your organization in Snyk settings">?</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="activateSnykIac" {{if eq .Settings.ActivateSnykIac "true"}}checked{{end}}>
                                Activate Snyk IaC
                                <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Find and fix your IaC misconfigurations">?</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="scanningMode">Scanning Mode <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Choose whether to run Snyk Code scans in the background (auto), or only when you run the Rescan command (manual)">?</span></label>
                        <select id="scanningMode" name="scanningMode">
                            <option value="auto" {{if eq .Settings.ScanningMode "auto"}}selected{{end}}>Auto</option>
                            <option value="manual" {{if eq .Settings.ScanningMode "manual"}}selected{{end}}>Manual</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="section">
                    <h2>Filtering and Display</h2>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Filter by Severity <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Select which severity levels to display in the results">?</span></label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="filterSeverity_critical" {{if .Settings.FilterSeverity}}{{if .Settings.FilterSeverity.Critical}}checked{{end}}{{end}}>
                                        Critical
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="filterSeverity_high" {{if .Settings.FilterSeverity}}{{if .Settings.FilterSeverity.High}}checked{{end}}{{end}}>
                                        High
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="filterSeverity_medium" {{if .Settings.FilterSeverity}}{{if .Settings.FilterSeverity.Medium}}checked{{end}}{{end}}>
                                        Medium
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="filterSeverity_low" {{if .Settings.FilterSeverity}}{{if .Settings.FilterSeverity.Low}}checked{{end}}{{end}}>
                                        Low
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Issue View Options <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Code Consistent Ignores helps your teams focus on important tasks by filtering out distractions. It ensures that once an ignore is created, it is consistently respected regardless of how and where the test is run">?</span></label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="issueViewOptions_openIssues" {{if .Settings.IssueViewOptions}}{{if .Settings.IssueViewOptions.OpenIssues}}checked{{end}}{{end}}>
                                        Show Open Issues
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="issueViewOptions_ignoredIssues" {{if .Settings.IssueViewOptions}}{{if .Settings.IssueViewOptions.IgnoredIssues}}checked{{end}}{{end}}>
                                        Show Ignored Issues
                                    </label>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="riskScoreThreshold">Filter by Risk Score <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Minimum risk score to display issues. Valid range: 0 to 1000 (0 = show all issues)">?</span></label>
                                <input type="number" id="riskScoreThreshold" name="riskScoreThreshold" min="0" max="1000" value="{{if .Settings.RiskScoreThreshold}}{{.Settings.RiskScoreThreshold}}{{end}}" placeholder="0">
                                <span id="riskScore-error" class="error-message hidden">Risk score must be between 0 and 1000</span>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="enableDeltaFindings">Delta Findings <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Specifies whether to see all issues or only net new issues. Net new issues option requires a Git repository, where it compares findings with those in the base branch">?</span></label>
                                <select id="enableDeltaFindings" name="enableDeltaFindings">
                                    <option value="false" {{if ne .Settings.EnableDeltaFindings "true"}}selected{{end}}>All Issues</option>
                                    <option value="true" {{if eq .Settings.EnableDeltaFindings "true"}}selected{{end}}>Net New Issues</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 2: Authentication and CLI Configuration -->
        <div class="row">
            <div class="col-md-6">
                <div class="section">
                    <h2>Authentication</h2>

                    <div class="form-group">
                        <label for="authenticationMethod">Authentication Method <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Specifies whether to authenticate with OAuth2, PAT, or with an API token (Legacy). Note: OAuth2 authentication is recommended as it provides enhanced security">?</span></label>
                        <select id="authenticationMethod" name="authenticationMethod">
                            <option value="token" {{if eq .Settings.AuthenticationMethod "token"}}selected{{end}}>Token</option>
                            <option value="oauth" {{if eq .Settings.AuthenticationMethod "oauth"}}selected{{end}}>OAuth</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="endpoint">Endpoint <span class="badge bg-secondary" data-bs-toggle="tooltip" title="If you're using SSO with Snyk and OAuth2, this is automatically populated. For public regional instances, see Snyk documentation. For private instances, contact your team or account manager">?</span></label>
                        <input type="text" id="endpoint" name="endpoint" value="{{.Settings.Endpoint}}" placeholder="https://app.snyk.io/api">
                        <span id="endpoint-error" class="error-message hidden">Invalid Endpoint URL. Expected format: https://api.snyk.io or https://api.*.snykgov.io</span>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="insecure" {{if eq .Settings.Insecure "true"}}checked{{end}}>
                            Insecure (Skip SSL Verification)
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="token">Token</label>
                        <div class="button-group">
                            <input type="password" id="token" name="token" value="{{.Settings.Token}}" placeholder="Snyk API Token">
                            <button type="button" id="authenticate-btn">Authenticate</button>
                            <button type="button" id="logout-btn" class="secondary">Logout</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="section">
                    <h2>CLI Configuration</h2>

                    <div class="form-group">
                        <label for="cliPath">CLI Path <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Path to Snyk CLI executable">?</span></label>
                        <input type="file" id="cliPathPicker">
                        <div class="button-group">
                            <input type="text" id="cliPath" name="cliPath" value="{{.Settings.CliPath}}" placeholder="Path to Snyk CLI">
                            <button type="button" id="browse-cli-btn">Browse</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="manageBinariesAutomatically" {{if eq .Settings.ManageBinariesAutomatically "true"}}checked{{end}}>
                            Manage Binaries Automatically
                            <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Automatically download and manage Snyk CLI binaries">?</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="cliReleaseChannel">CLI Release Channel <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Release channel for Snyk CLI downloads (stable, preview, or rc)">?</span></label>
                        <select id="cliReleaseChannel" name="cliReleaseChannel">
                            <option value="stable" {{if eq .CliReleaseChannel "stable"}}selected{{end}}>Stable</option>
                            <option value="preview" {{if eq .CliReleaseChannel "preview"}}selected{{end}}>Preview</option>
                            <option value="rc" {{if eq .CliReleaseChannel "rc"}}selected{{end}}>Release Candidate</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="baseUrl">Base URL <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Base URL for downloading Snyk CLI binaries">?</span></label>
                        <input type="text" id="baseUrl" name="baseUrl" value="{{.Settings.BaseUrl}}" placeholder="https://downloads.snyk.io">
                    </div>
                </div>
            </div>
        </div>

        <!-- Folder Specific Settings -->
        <div class="row">
            <div class="col-md-12">
                <div class="section">
                    <h2>{{.FolderLabel}} Settings</h2>
                    {{if .Settings.FolderConfigs}}
                    {{range $index, $folder := .Settings.FolderConfigs}}
            <div class="folder-config">
                <button class="btn btn-link folder-toggle text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-bs-toggle="collapse" data-bs-target="#folder-{{$index}}" aria-expanded="false" aria-controls="folder-{{$index}}">
                    <span>{{$folder.FolderPath}}</span>
                    <span class="collapse-icon">▼</span>
                </button>
                <input type="hidden" name="folder_{{$index}}_folderPath" value="{{$folder.FolderPath}}">
                <div class="collapse folder-content" id="folder-{{$index}}">

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="folder_{{$index}}_autoOrg" data-index="{{$index}}" {{if not $folder.OrgSetByUser}}checked{{end}}>
                        Auto Select Organization
                        <span class="badge bg-secondary" data-bs-toggle="tooltip" title="When enabled, Snyk will automatically select the most appropriate organization for your project using context found in your repository. If disabled, you can manually specify the organization">?</span>
                    </label>
                    <input type="hidden" name="folder_{{$index}}_orgSetByUser" id="folder_{{$index}}_orgSetByUser" value="{{if $folder.OrgSetByUser}}true{{else}}false{{end}}">
                </div>

                <div class="form-group">
                    <label for="folder_{{$index}}_preferredOrg">Organization <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Specify the organization (ID or name) for this folder. If auto-select is enabled, this will show the automatically determined organization (read-only)">?</span></label>
                    <input type="text" id="folder_{{$index}}_preferredOrg" name="folder_{{$index}}_preferredOrg" value="{{if $folder.OrgSetByUser}}{{$folder.PreferredOrg}}{{else}}{{$folder.AutoDeterminedOrg}}{{end}}" data-preferred-org="{{$folder.PreferredOrg}}" data-auto-org="{{$folder.AutoDeterminedOrg}}" placeholder="Organization UUID or Slug" {{if not $folder.OrgSetByUser}}readonly{{end}}>
                    <input type="hidden" name="folder_{{$index}}_autoDeterminedOrg" value="{{$folder.AutoDeterminedOrg}}">
                </div>

                <div class="form-group">
                    <label for="folder_{{$index}}_additionalParameters">Additional CLI Parameters <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Parameters to pass to Snyk CLI for this folder's scans. Space-separated arguments (e.g., --severity-threshold=high --debug)">?</span></label>
                    <input type="text" id="folder_{{$index}}_additionalParameters" name="folder_{{$index}}_additionalParameters" value="{{range $p := $folder.AdditionalParameters}}{{$p}} {{end}}" placeholder="--severity-threshold=high">
                </div>

                <div class="form-group">
                    <button class="collapsible-header text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-bs-toggle="collapse" data-bs-target="#folder-{{$index}}-prescan" aria-expanded="false" aria-controls="folder-{{$index}}-prescan">
                        <span>Pre/Post Scan Commands <span class="badge bg-secondary" data-bs-toggle="tooltip" title="Configure commands to run before/after scans for each product. Commands run in the folder context.">?</span></span>
                        <span class="collapse-icon">▼</span>
                    </button>
                    <div class="collapse" id="folder-{{$index}}-prescan">
                        <div class="mt-2">
                            <button class="btn btn-link folder-toggle text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-bs-toggle="collapse" data-bs-target="#folder-{{$index}}-oss" aria-expanded="false" aria-controls="folder-{{$index}}-oss">
                                <span>Snyk Open Source</span>
                                <span class="collapse-icon">▶</span>
                            </button>
                            <div class="collapse folder-content" id="folder-{{$index}}-oss">
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_oss_preScanCommand">Pre-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_oss_preScanCommand" name="folder_{{$index}}_scanConfig_oss_preScanCommand" value="{{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.oss}}{{$folder.ScanCommandConfig.oss.command}}{{end}}{{end}}" placeholder="npm install">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_oss_preScanOnlyReferenceFolder" {{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.oss}}{{if $folder.ScanCommandConfig.oss.preScanOnlyReferenceFolder}}checked{{end}}{{end}}{{end}}>
                                        Pre-Scan Only Reference Folder
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_oss_postScanCommand">Post-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_oss_postScanCommand" name="folder_{{$index}}_scanConfig_oss_postScanCommand" value="{{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.oss}}{{$folder.ScanCommandConfig.oss.postScanCommand}}{{end}}{{end}}" placeholder="cleanup.sh">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_oss_postScanOnlyReferenceFolder" {{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.oss}}{{if $folder.ScanCommandConfig.oss.postScanOnlyReferenceFolder}}checked{{end}}{{end}}{{end}}>
                                        Post-Scan Only Reference Folder
                                    </label>
                                </div>
                            </div>

                            <button class="btn btn-link folder-toggle text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-bs-toggle="collapse" data-bs-target="#folder-{{$index}}-code" aria-expanded="false" aria-controls="folder-{{$index}}-code">
                                <span>Snyk Code</span>
                                <span class="collapse-icon">▶</span>
                            </button>
                            <div class="collapse folder-content" id="folder-{{$index}}-code">
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_code_preScanCommand">Pre-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_code_preScanCommand" name="folder_{{$index}}_scanConfig_code_preScanCommand" value="{{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.code}}{{$folder.ScanCommandConfig.code.command}}{{end}}{{end}}" placeholder="prepare.sh">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_code_preScanOnlyReferenceFolder" {{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.code}}{{if $folder.ScanCommandConfig.code.preScanOnlyReferenceFolder}}checked{{end}}{{end}}{{end}}>
                                        Pre-Scan Only Reference Folder
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_code_postScanCommand">Post-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_code_postScanCommand" name="folder_{{$index}}_scanConfig_code_postScanCommand" value="{{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.code}}{{$folder.ScanCommandConfig.code.postScanCommand}}{{end}}{{end}}" placeholder="cleanup.sh">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_code_postScanOnlyReferenceFolder" {{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.code}}{{if $folder.ScanCommandConfig.code.postScanOnlyReferenceFolder}}checked{{end}}{{end}}{{end}}>
                                        Post-Scan Only Reference Folder
                                    </label>
                                </div>
                            </div>

                            <button class="btn btn-link folder-toggle text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-bs-toggle="collapse" data-bs-target="#folder-{{$index}}-iac" aria-expanded="false" aria-controls="folder-{{$index}}-iac">
                                <span>Snyk IaC</span>
                                <span class="collapse-icon">▶</span>
                            </button>
                            <div class="collapse folder-content" id="folder-{{$index}}-iac">
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_iac_preScanCommand">Pre-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_iac_preScanCommand" name="folder_{{$index}}_scanConfig_iac_preScanCommand" value="{{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.iac}}{{$folder.ScanCommandConfig.iac.command}}{{end}}{{end}}" placeholder="terraform init">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_iac_preScanOnlyReferenceFolder" {{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.iac}}{{if $folder.ScanCommandConfig.iac.preScanOnlyReferenceFolder}}checked{{end}}{{end}}{{end}}>
                                        Pre-Scan Only Reference Folder
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_iac_postScanCommand">Post-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_iac_postScanCommand" name="folder_{{$index}}_scanConfig_iac_postScanCommand" value="{{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.iac}}{{$folder.ScanCommandConfig.iac.postScanCommand}}{{end}}{{end}}" placeholder="cleanup.sh">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_iac_postScanOnlyReferenceFolder" {{if $folder.ScanCommandConfig}}{{if $folder.ScanCommandConfig.iac}}{{if $folder.ScanCommandConfig.iac.postScanOnlyReferenceFolder}}checked{{end}}{{end}}{{end}}>
                                        Post-Scan Only Reference Folder
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
                    {{end}}
                    {{else}}
                    <p>No {{.FolderLabel | toLower}}s configured. Open a workspace to configure {{.FolderLabel | toLower}}-specific settings.</p>
                    {{end}}
                </div>
            </div>
        </div>
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" nonce="{{.Nonce}}"></script>
    <script nonce="{{.Nonce}}">
        {{.Utils}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.DirtyTracker}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.Scripts}}
    </script>
</body>
</html>
