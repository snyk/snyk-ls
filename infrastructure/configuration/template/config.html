<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="style-src 'self' 'nonce-{{.Nonce}}';
                 script-src 'nonce-{{.Nonce}}';
                 font-src 'self';" />
    <title>Snyk Settings</title>
    <script nonce="{{.Nonce}}">
        {{.IE11Polyfill}}
    </script>
    <style nonce="{{.Nonce}}">
        {{.BootstrapCSS}}
    </style>
    <style nonce="{{.Nonce}}">
        {{.Styles}}
    </style>
</head>
<body>
    <form id="configForm">
        <!-- Row 1: Scan Configuration and Filtering -->
        <div class="row">
            <div class="col-md-6">
                <div class="section">
                    <div class="section-header">
                        <h2>Scan Configuration</h2>
                        <button type="button" class="reset-section-btn" data-section="scanConfiguration" title="Reset this section to defaults">Reset</button>
                    </div>

                    <div class="form-group">
                        <h3>Snyk Products</h3>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="activateSnykOpenSource" {{if eq .Settings.ActivateSnykOpenSource "true"}}checked{{end}}>
                                <span data-toggle="tooltip" title="Find and fix open source dependency issues">Snyk Open Source</span>
                                <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="activateSnykOpenSource"></span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="activateSnykCode" {{if eq .Settings.ActivateSnykCode "true"}}checked{{end}}>
                                <span data-toggle="tooltip" title="Find and fix security issues in your application code in real time. Note: Snyk Code must be enabled for your organization in Snyk settings">Snyk Code</span>
                                <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="activateSnykCode"></span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="activateSnykIac" {{if eq .Settings.ActivateSnykIac "true"}}checked{{end}}>
                                <span data-toggle="tooltip" title="Find and fix your IaC misconfigurations">Snyk IaC</span>
                                <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="activateSnykIac"></span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="scanningMode"><span data-toggle="tooltip" title="Choose whether to run Snyk Code scans in the background (auto), or only when you run the Rescan command (manual)">Scanning Mode</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="scanningMode"></span></label>
                        <select id="scanningMode" name="scanningMode">
                            <option value="auto" {{if eq .Settings.ScanningMode "auto"}}selected{{end}}>Auto</option>
                            <option value="manual" {{if eq .Settings.ScanningMode "manual"}}selected{{end}}>Manual</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="organization"><span data-toggle="tooltip" title="DEPRECATED: This global organization setting is deprecated. Please use the {{.FolderLabel | toLower}}-specific organization settings in the {{.FolderLabel}} Settings section below for better control">Organization <span class="deprecated-label">⚠ Deprecated</span></span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="organization"></span></label>
                        <input type="text" id="organization" name="organization" value="{{.Settings.Organization}}" placeholder="Organization UUID or Slug">
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="section">
                    <div class="section-header">
                        <h2>Filtering and Display</h2>
                        <button type="button" class="reset-section-btn" data-section="filteringDisplay" title="Reset this section to defaults">Reset</button>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label><span data-toggle="tooltip" title="Select which severity levels to display in the results">Filter by Severity</span></label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="filterSeverity_critical" {{if .Settings.FilterSeverity}}{{if .Settings.FilterSeverity.Critical}}checked{{end}}{{end}}>
                                        Critical
                                        <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="filterSeverity_critical"></span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="filterSeverity_high" {{if .Settings.FilterSeverity}}{{if .Settings.FilterSeverity.High}}checked{{end}}{{end}}>
                                        High
                                        <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="filterSeverity_high"></span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="filterSeverity_medium" {{if .Settings.FilterSeverity}}{{if .Settings.FilterSeverity.Medium}}checked{{end}}{{end}}>
                                        Medium
                                        <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="filterSeverity_medium"></span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="filterSeverity_low" {{if .Settings.FilterSeverity}}{{if .Settings.FilterSeverity.Low}}checked{{end}}{{end}}>
                                        Low
                                        <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="filterSeverity_low"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label><span data-toggle="tooltip" title="Code Consistent Ignores helps your teams focus on important tasks by filtering out distractions. It ensures that once an ignore is created, it is consistently respected regardless of how and where the test is run">Issue View Options</span></label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="issueViewOptions_openIssues" {{if .Settings.IssueViewOptions}}{{if .Settings.IssueViewOptions.OpenIssues}}checked{{end}}{{end}}>
                                        Show Open Issues
                                        <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="issueViewOptions_openIssues"></span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="issueViewOptions_ignoredIssues" {{if .Settings.IssueViewOptions}}{{if .Settings.IssueViewOptions.IgnoredIssues}}checked{{end}}{{end}}>
                                        Show Ignored Issues
                                        <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="issueViewOptions_ignoredIssues"></span>
                                    </label>
                                </div>
                            </div>

                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="riskScoreThreshold"><span data-toggle="tooltip" title="[Closed Beta] Minimum risk score to display issues. Valid range: 0 to 1000 (0 = show all issues)">[Closed Beta] Filter by Risk Score</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="riskScoreThreshold"></span></label>
                                <input type="number" id="riskScoreThreshold" name="riskScoreThreshold" min="0" max="1000" value="{{if ne .Settings.RiskScoreThreshold nil}}{{.Settings.RiskScoreThreshold}}{{end}}" placeholder="0">
                                <span id="riskScore-error" class="error-message hidden">Risk score must be between 0 and 1000</span>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="enableDeltaFindings"><span data-toggle="tooltip" title="Specifies whether to see all issues or only net new issues. Net new issues option requires a Git repository, where it compares findings with those in the base branch">Delta Findings</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="enableDeltaFindings"></span></label>
                                <select id="enableDeltaFindings" name="enableDeltaFindings">
                                    <option value="false" {{if ne .Settings.EnableDeltaFindings "true"}}selected{{end}}>All Issues</option>
                                    <option value="true" {{if eq .Settings.EnableDeltaFindings "true"}}selected{{end}}>Net New Issues</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 2: Authentication and CLI Configuration -->
        <div class="row">
            <div class="col-md-6">
                <div class="section">
                    <div class="section-header">
                        <h2>Authentication</h2>
                        <button type="button" class="reset-section-btn" data-section="authentication" title="Reset this section to defaults">Reset</button>
                    </div>

                    <div class="form-group">
                        <label for="authenticationMethod"><span data-toggle="tooltip" title="Specifies whether to authenticate with OAuth2, PAT (Personal Access Token), or with an API token (Legacy). Note: OAuth2 authentication is recommended as it provides enhanced security">Authentication Method</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="authenticationMethod"></span></label>
                        <select id="authenticationMethod" name="authenticationMethod">
                            <option value="oauth" {{if eq .Settings.AuthenticationMethod "oauth"}}selected{{end}}>OAuth2 (Recommended)</option>
                            <option value="pat" {{if eq .Settings.AuthenticationMethod "pat"}}selected{{end}}>Personal Access Token</option>
                            <option value="token" {{if eq .Settings.AuthenticationMethod "token"}}selected{{end}}>API Token (Legacy)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="endpoint"><span data-toggle="tooltip" title="If you're using SSO with Snyk and OAuth2, this is automatically populated. For public regional instances, see Snyk documentation. For private instances, contact your team or account manager">Endpoint</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="endpoint"></span></label>
                        <input type="text" id="endpoint" name="endpoint" value="{{.Settings.Endpoint}}" placeholder="https://app.snyk.io/api">
                        <span id="endpoint-error" class="error-message hidden">Invalid Endpoint URL. Expected format: api.snyk.io, api.*.snyk.io or api.*.snykgov.io</span>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="insecure" {{if eq .Settings.Insecure "true"}}checked{{end}}>
                            <span data-toggle="tooltip" title="If enabled, the plugin will ignore SSL certificate errors. Use this when connecting to self-signed or internal CA servers.">Insecure (Skip SSL Verification)</span>
                            <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="insecure"></span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="token">Token <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="token"></span></label>
                        <div class="button-group">
                            <input type="password" id="token" name="token" value="{{.Settings.Token}}" placeholder="Snyk API Token">
                            <button type="button" id="authenticate-btn">Authenticate</button>
                            <button type="button" id="logout-btn" class="secondary">Logout</button>
                        </div>
                        <span id="token-error" class="error-message hidden"></span>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="section">
                    <div class="section-header">
                        <h2>CLI Configuration</h2>
                        <button type="button" class="reset-section-btn" data-section="cliConfiguration" title="Reset this section to defaults">Reset</button>
                    </div>

                    <div class="form-group">
                        <label for="cliPath"><span data-toggle="tooltip" title="Path to Snyk CLI executable">CLI Path</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="cliPath"></span></label>
                        <input type="text" id="cliPath" name="cliPath" value="{{.Settings.CliPath}}" placeholder="/path/to/snyk-cli">
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="manageBinariesAutomatically" {{if eq .Settings.ManageBinariesAutomatically "true"}}checked{{end}}>
                            <span data-toggle="tooltip" title="Automatically download and manage Snyk CLI binaries">Manage Binaries Automatically</span>
                            <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="manageBinariesAutomatically"></span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="cliReleaseChannel"><span data-toggle="tooltip" title="Release channel for Snyk CLI downloads (stable, preview, or rc)">CLI Release Channel</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="cliReleaseChannel"></span></label>
                        <select id="cliReleaseChannel" name="cliReleaseChannel">
                            <option value="stable" {{if eq .CliReleaseChannel "stable"}}selected{{end}}>Stable</option>
                            <option value="rc" {{if eq .CliReleaseChannel "rc"}}selected{{end}}>Release Candidate</option>
                            <option value="preview" {{if eq .CliReleaseChannel "preview"}}selected{{end}}>Preview</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="cliBaseDownloadURL"><span data-toggle="tooltip" title="Base URL for downloading Snyk CLI binaries. The default is https://downloads.snyk.io. For FIPS-enabled CLIs (Windows/Linux only), use https://downloads.snyk.io/fips">CLI Download Base URL</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="cliBaseDownloadURL"></span></label>
                        <input type="text" id="cliBaseDownloadURL" name="cliBaseDownloadURL" value="{{.Settings.CliBaseDownloadURL}}" placeholder="https://downloads.snyk.io">
                    </div>
                </div>
            </div>
        </div>

        <!-- Permissions -->
        <div class="row">
            <div class="col-md-12">
                <div class="section">
                    <div class="section-header">
                        <h2>Permissions</h2>
                        <button type="button" class="reset-section-btn" data-section="permissions" title="Reset this section to defaults">Reset</button>
                    </div>

                    <div class="form-group">
                        <button class="collapsible-header text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-toggle="collapse" data-target="#trustedFoldersSection" aria-expanded="false" aria-controls="trustedFoldersSection">
                            <span><span data-toggle="tooltip" title="List of folders that are trusted for scanning. Type folder paths directly">Trusted Folders</span> <span class="config-scope-slot" data-config-scope-slot="true" data-setting-key="trustedFolders"></span></span>
                            <span class="collapse-icon">▼</span>
                        </button>
                        <div class="collapse" id="trustedFoldersSection">
                            <div id="trustedFoldersList" class="trusted-folders-list mt-2">
                                {{range $index, $folder := .Settings.TrustedFolders}}
                                <div class="trusted-folder-item" data-index="{{$index}}">
                                    <div class="button-group">
                                        <input type="text" name="trustedFolder_{{$index}}" value="{{$folder}}" placeholder="/path/to/trusted/folder">
                                        <button type="button" class="remove-trusted-folder" data-index="{{$index}}" title="Remove">✕</button>
                                    </div>
                                </div>
                                {{end}}
                            </div>
                            <div class="button-container-right">
                                <button type="button" id="addTrustedFolderBtn">Add Folder</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Folder Specific Settings -->
        <div class="row">
            <div class="col-md-12">
                <div class="section">
                    <h2>{{.FolderLabel}} Settings</h2>
                    {{if .Settings.FolderConfigs}}
                    {{range $index, $folder := .Settings.FolderConfigs}}
            <div class="folder-config">
                <button class="btn folder-toggle text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-toggle="collapse" data-target="#folder-{{$index}}" aria-expanded="false" aria-controls="folder-{{$index}}">
                    <span>{{$folder.FolderPath}}</span>
                    <span class="collapse-icon">▼</span>
                </button>
                <input type="hidden" name="folder_{{$index}}_folderPath" value="{{$folder.FolderPath}}">
                <div class="collapse folder-content" id="folder-{{$index}}">

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="folder_{{$index}}_autoOrg" data-index="{{$index}}" {{if not $folder.OrgSetByUser}}checked{{end}}>
                        <span data-toggle="tooltip" title="When enabled, Snyk will automatically select the most appropriate organization for your project using context found in your repository. If disabled, you can manually specify the organization">Auto Select Organization</span>
                    </label>
                    <input type="hidden" name="folder_{{$index}}_orgSetByUser" id="folder_{{$index}}_orgSetByUser" value="{{if $folder.OrgSetByUser}}true{{else}}false{{end}}">
                </div>

                <div class="form-group">
                    <label for="folder_{{$index}}_preferredOrg"><span data-toggle="tooltip" title="Specify the organization (ID or name) for this folder. If auto-select is enabled, this will show the automatically determined organization (read-only)">Organization</span></label>
                    <input type="text" id="folder_{{$index}}_preferredOrg" name="folder_{{$index}}_preferredOrg" value="{{if $folder.OrgSetByUser}}{{$folder.PreferredOrg}}{{else}}{{$folder.AutoDeterminedOrg}}{{end}}" data-preferred-org="{{$folder.PreferredOrg}}" data-auto-org="{{$folder.AutoDeterminedOrg}}" placeholder="Organization UUID or Slug" {{if not $folder.OrgSetByUser}}readonly{{end}}>
                    <input type="hidden" name="folder_{{$index}}_autoDeterminedOrg" value="{{$folder.AutoDeterminedOrg}}">
                </div>

                <div class="form-group">
                    <label for="folder_{{$index}}_additionalParameters"><span data-toggle="tooltip" title="Parameters to pass to Snyk CLI for this folder's scans. Space-separated arguments (e.g., --severity-threshold=high --debug)">Additional CLI Parameters</span></label>
                    <input type="text" id="folder_{{$index}}_additionalParameters" name="folder_{{$index}}_additionalParameters" value="{{range $p := $folder.AdditionalParameters}}{{$p}} {{end}}" placeholder="--severity-threshold=high">
                </div>

                <div class="form-group">
                    <label for="folder_{{$index}}_additionalEnv"><span data-toggle="tooltip" title="Environment variables for this folder. Format: VAR1=value1;VAR2=value2">Additional Environment Variables</span></label>
                    <input type="text" id="folder_{{$index}}_additionalEnv" name="folder_{{$index}}_additionalEnv" value="{{$folder.AdditionalEnv}}" placeholder="VAR1=value1;VAR2=value2">
                    <div id="folder_{{$index}}_additionalEnv-error" class="error-message hidden">Invalid format. Use: VAR1=value1;VAR2=value2</div>
                </div>

                <div class="form-group">
                    <button class="collapsible-header text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-toggle="collapse" data-target="#folder-{{$index}}-prescan" aria-expanded="false" aria-controls="folder-{{$index}}-prescan">
                        <span data-toggle="tooltip" title="Configure commands to run before/after scans for each product. Commands run in the folder context.">Pre/Post Scan Commands</span>
                        <span class="collapse-icon">▼</span>
                    </button>
                    <div class="collapse ml-1" id="folder-{{$index}}-prescan">
                        <div class="mt-2">
                            <button class="btn folder-toggle text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-toggle="collapse" data-target="#folder-{{$index}}-oss" aria-expanded="false" aria-controls="folder-{{$index}}-oss">
                                <span>Snyk Open Source</span>
                                <span class="collapse-icon">▶</span>
                            </button>
                            <div class="collapse folder-content" id="folder-{{$index}}-oss">
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_Snyk_Open_Source_preScanCommand">Pre-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_Snyk_Open_Source_preScanCommand" name="folder_{{$index}}_scanConfig_Snyk_Open_Source_preScanCommand" value="{{with getScanConfig $folder.ScanCommandConfig "Snyk Open Source"}}{{.PreScanCommand}}{{end}}" placeholder="npm install">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_Snyk_Open_Source_preScanOnlyReferenceFolder" {{with getScanConfig $folder.ScanCommandConfig "Snyk Open Source"}}{{if .PreScanOnlyReferenceFolder}}checked{{end}}{{end}}>
                                        Run only in reference folder
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_Snyk_Open_Source_postScanCommand">Post-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_Snyk_Open_Source_postScanCommand" name="folder_{{$index}}_scanConfig_Snyk_Open_Source_postScanCommand" value="{{with getScanConfig $folder.ScanCommandConfig "Snyk Open Source"}}{{.PostScanCommand}}{{end}}" placeholder="cleanup.sh">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_Snyk_Open_Source_postScanOnlyReferenceFolder" {{with getScanConfig $folder.ScanCommandConfig "Snyk Open Source"}}{{if .PostScanOnlyReferenceFolder}}checked{{end}}{{end}}>
                                        Run only in reference folder
                                    </label>
                                </div>
                            </div>

                            <button class="btn folder-toggle text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-toggle="collapse" data-target="#folder-{{$index}}-code" aria-expanded="false" aria-controls="folder-{{$index}}-code">
                                <span>Snyk Code</span>
                                <span class="collapse-icon">▶</span>
                            </button>
                            <div class="collapse folder-content" id="folder-{{$index}}-code">
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_Snyk_Code_preScanCommand">Pre-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_Snyk_Code_preScanCommand" name="folder_{{$index}}_scanConfig_Snyk_Code_preScanCommand" value="{{with getScanConfig $folder.ScanCommandConfig "Snyk Code"}}{{.PreScanCommand}}{{end}}" placeholder="prepare.sh">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_Snyk_Code_preScanOnlyReferenceFolder" {{with getScanConfig $folder.ScanCommandConfig "Snyk Code"}}{{if .PreScanOnlyReferenceFolder}}checked{{end}}{{end}}>
                                        Run only in reference folder
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_Snyk_Code_postScanCommand">Post-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_Snyk_Code_postScanCommand" name="folder_{{$index}}_scanConfig_Snyk_Code_postScanCommand" value="{{with getScanConfig $folder.ScanCommandConfig "Snyk Code"}}{{.PostScanCommand}}{{end}}" placeholder="cleanup.sh">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_Snyk_Code_postScanOnlyReferenceFolder" {{with getScanConfig $folder.ScanCommandConfig "Snyk Code"}}{{if .PostScanOnlyReferenceFolder}}checked{{end}}{{end}}>
                                        Run only in reference folder
                                    </label>
                                </div>
                            </div>

                            <button class="btn folder-toggle text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-toggle="collapse" data-target="#folder-{{$index}}-iac" aria-expanded="false" aria-controls="folder-{{$index}}-iac">
                                <span>Snyk IaC</span>
                                <span class="collapse-icon">▶</span>
                            </button>
                            <div class="collapse folder-content" id="folder-{{$index}}-iac">
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_Snyk_IaC_preScanCommand">Pre-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_Snyk_IaC_preScanCommand" name="folder_{{$index}}_scanConfig_Snyk_IaC_preScanCommand" value="{{with getScanConfig $folder.ScanCommandConfig "Snyk IaC"}}{{.PreScanCommand}}{{end}}" placeholder="terraform init">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_Snyk_IaC_preScanOnlyReferenceFolder" {{with getScanConfig $folder.ScanCommandConfig "Snyk IaC"}}{{if .PreScanOnlyReferenceFolder}}checked{{end}}{{end}}>
                                        Run only in reference folder
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label for="folder_{{$index}}_scanConfig_Snyk_IaC_postScanCommand">Post-Scan Command</label>
                                    <input type="text" id="folder_{{$index}}_scanConfig_Snyk_IaC_postScanCommand" name="folder_{{$index}}_scanConfig_Snyk_IaC_postScanCommand" value="{{with getScanConfig $folder.ScanCommandConfig "Snyk IaC"}}{{.PostScanCommand}}{{end}}" placeholder="cleanup.sh">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_scanConfig_Snyk_IaC_postScanOnlyReferenceFolder" {{with getScanConfig $folder.ScanCommandConfig "Snyk IaC"}}{{if .PostScanOnlyReferenceFolder}}checked{{end}}{{end}}>
                                        Run only in reference folder
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {{if and $folder.EffectiveConfig $.EnableLdxSyncConfig}}
                <div class="form-group">
                    <button class="collapsible-header text-start w-100 d-flex justify-content-between align-items-center p-0" type="button" data-toggle="collapse" data-target="#folder-{{$index}}-overrides" aria-expanded="false" aria-controls="folder-{{$index}}-overrides">
                        <span data-toggle="tooltip" title="Override organization policy settings for this folder. Locked settings cannot be changed.">Policy Overrides</span>
                        <span class="collapse-icon">▼</span>
                    </button>
                    <div class="collapse ml-1" id="folder-{{$index}}-overrides">
                        <div class="mt-2">
                            <p class="text-muted small">These settings can be customized per-folder. Locked settings are enforced by your organization.</p>

                            <!-- Scanning Mode Override -->
                            {{with getEffectiveValue $folder.EffectiveConfig "scan_automatic"}}
                            <div class="form-group {{if isLocked $folder.EffectiveConfig "scan_automatic"}}field-locked{{end}}">
                                <label for="folder_{{$index}}_override_scan_automatic">
                                    <span data-toggle="tooltip" title="Override scanning mode for this folder">Scanning Mode</span>
                                    {{if isLocked $folder.EffectiveConfig "scan_automatic"}}<span class="locked-indicator">Locked</span>{{end}}
                                    <span class="source-badge {{getSourceClass $folder.EffectiveConfig "scan_automatic"}}">{{getSourceLabel $folder.EffectiveConfig "scan_automatic"}}</span>
                                </label>
                                <select id="folder_{{$index}}_override_scan_automatic" name="folder_{{$index}}_override_scan_automatic" data-setting="scan_automatic" {{if isLocked $folder.EffectiveConfig "scan_automatic"}}disabled{{end}}>
                                    <option value="auto" {{if isAutoScan .Value}}selected{{end}}>Auto</option>
                                    <option value="manual" {{if not (isAutoScan .Value)}}selected{{end}}>Manual</option>
                                </select>
                            </div>
                            {{end}}

                            <!-- Delta Findings Override -->
                            {{with getEffectiveValue $folder.EffectiveConfig "scan_net_new"}}
                            <div class="form-group {{if isLocked $folder.EffectiveConfig "scan_net_new"}}field-locked{{end}}">
                                <label for="folder_{{$index}}_override_scan_net_new">
                                    <span data-toggle="tooltip" title="Override delta findings setting for this folder">Delta Findings</span>
                                    {{if isLocked $folder.EffectiveConfig "scan_net_new"}}<span class="locked-indicator">Locked</span>{{end}}
                                    <span class="source-badge {{getSourceClass $folder.EffectiveConfig "scan_net_new"}}">{{getSourceLabel $folder.EffectiveConfig "scan_net_new"}}</span>
                                </label>
                                <select id="folder_{{$index}}_override_scan_net_new" name="folder_{{$index}}_override_scan_net_new" data-setting="scan_net_new" {{if isLocked $folder.EffectiveConfig "scan_net_new"}}disabled{{end}}>
                                    <option value="false" {{if not .Value}}selected{{end}}>All Issues</option>
                                    <option value="true" {{if .Value}}selected{{end}}>Net New Issues</option>
                                </select>
                            </div>
                            {{end}}

                            <!-- Severity Filter Override -->
                            {{with getEffectiveValue $folder.EffectiveConfig "enabled_severities"}}
                            <div class="form-group {{if isLocked $folder.EffectiveConfig "enabled_severities"}}field-locked{{end}}">
                                <label>
                                    <span data-toggle="tooltip" title="Override severity filter for this folder">Severity Filter</span>
                                    {{if isLocked $folder.EffectiveConfig "enabled_severities"}}<span class="locked-indicator">Locked</span>{{end}}
                                    <span class="source-badge {{getSourceClass $folder.EffectiveConfig "enabled_severities"}}">{{getSourceLabel $folder.EffectiveConfig "enabled_severities"}}</span>
                                </label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_override_severity_critical" data-setting="enabled_severities" data-severity="critical" {{if isLocked $folder.EffectiveConfig "enabled_severities"}}disabled{{end}}>
                                        Critical
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_override_severity_high" data-setting="enabled_severities" data-severity="high" {{if isLocked $folder.EffectiveConfig "enabled_severities"}}disabled{{end}}>
                                        High
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_override_severity_medium" data-setting="enabled_severities" data-severity="medium" {{if isLocked $folder.EffectiveConfig "enabled_severities"}}disabled{{end}}>
                                        Medium
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="folder_{{$index}}_override_severity_low" data-setting="enabled_severities" data-severity="low" {{if isLocked $folder.EffectiveConfig "enabled_severities"}}disabled{{end}}>
                                        Low
                                    </label>
                                </div>
                            </div>
                            {{end}}

                            <!-- Enabled Products Override -->
                            <div class="form-group">
                                <label>
                                    <span data-toggle="tooltip" title="Override enabled products for this folder">Enabled Products</span>
                                </label>
                                <div class="checkbox-group">
                                    {{with getEffectiveValue $folder.EffectiveConfig "snyk_oss_enabled"}}
                                    <label class="checkbox-label {{if isLocked $folder.EffectiveConfig "snyk_oss_enabled"}}field-locked{{end}}">
                                        <input type="checkbox" name="folder_{{$index}}_override_snyk_oss_enabled" data-setting="snyk_oss_enabled" {{if .Value}}checked{{end}} {{if isLocked $folder.EffectiveConfig "snyk_oss_enabled"}}disabled{{end}}>
                                        Snyk Open Source
                                        {{if isLocked $folder.EffectiveConfig "snyk_oss_enabled"}}<span class="locked-indicator">Locked</span>{{end}}
                                        <span class="source-badge {{getSourceClass $folder.EffectiveConfig "snyk_oss_enabled"}}">{{getSourceLabel $folder.EffectiveConfig "snyk_oss_enabled"}}</span>
                                    </label>
                                    {{end}}
                                    {{with getEffectiveValue $folder.EffectiveConfig "snyk_code_enabled"}}
                                    <label class="checkbox-label {{if isLocked $folder.EffectiveConfig "snyk_code_enabled"}}field-locked{{end}}">
                                        <input type="checkbox" name="folder_{{$index}}_override_snyk_code_enabled" data-setting="snyk_code_enabled" {{if .Value}}checked{{end}} {{if isLocked $folder.EffectiveConfig "snyk_code_enabled"}}disabled{{end}}>
                                        Snyk Code
                                        {{if isLocked $folder.EffectiveConfig "snyk_code_enabled"}}<span class="locked-indicator">Locked</span>{{end}}
                                        <span class="source-badge {{getSourceClass $folder.EffectiveConfig "snyk_code_enabled"}}">{{getSourceLabel $folder.EffectiveConfig "snyk_code_enabled"}}</span>
                                    </label>
                                    {{end}}
                                    {{with getEffectiveValue $folder.EffectiveConfig "snyk_iac_enabled"}}
                                    <label class="checkbox-label {{if isLocked $folder.EffectiveConfig "snyk_iac_enabled"}}field-locked{{end}}">
                                        <input type="checkbox" name="folder_{{$index}}_override_snyk_iac_enabled" data-setting="snyk_iac_enabled" {{if .Value}}checked{{end}} {{if isLocked $folder.EffectiveConfig "snyk_iac_enabled"}}disabled{{end}}>
                                        Snyk IaC
                                        {{if isLocked $folder.EffectiveConfig "snyk_iac_enabled"}}<span class="locked-indicator">Locked</span>{{end}}
                                        <span class="source-badge {{getSourceClass $folder.EffectiveConfig "snyk_iac_enabled"}}">{{getSourceLabel $folder.EffectiveConfig "snyk_iac_enabled"}}</span>
                                    </label>
                                    {{end}}
                                </div>
                            </div>

                            <!-- Issue View Options Override -->
                            {{with getEffectiveValue $folder.EffectiveConfig "issue_view_open_issues"}}
                            <div class="form-group {{if isLocked $folder.EffectiveConfig "issue_view_open_issues"}}field-locked{{end}}">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="folder_{{$index}}_override_issueViewOpenIssues" data-setting="issue_view_open_issues" {{if isLocked $folder.EffectiveConfig "issue_view_open_issues"}}disabled{{end}}>
                                    <span data-toggle="tooltip" title="Show open issues for this folder">Show Open Issues</span>
                                    {{if isLocked $folder.EffectiveConfig "issue_view_open_issues"}}<span class="locked-indicator">Locked</span>{{end}}
                                    <span class="source-badge {{getSourceClass $folder.EffectiveConfig "issue_view_open_issues"}}">{{getSourceLabel $folder.EffectiveConfig "issue_view_open_issues"}}</span>
                                </label>
                            </div>
                            {{end}}

                            {{with getEffectiveValue $folder.EffectiveConfig "issue_view_ignored_issues"}}
                            <div class="form-group {{if isLocked $folder.EffectiveConfig "issue_view_ignored_issues"}}field-locked{{end}}">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="folder_{{$index}}_override_issueViewIgnoredIssues" data-setting="issue_view_ignored_issues" {{if isLocked $folder.EffectiveConfig "issue_view_ignored_issues"}}disabled{{end}}>
                                    <span data-toggle="tooltip" title="Show ignored issues for this folder">Show Ignored Issues</span>
                                    {{if isLocked $folder.EffectiveConfig "issue_view_ignored_issues"}}<span class="locked-indicator">Locked</span>{{end}}
                                    <span class="source-badge {{getSourceClass $folder.EffectiveConfig "issue_view_ignored_issues"}}">{{getSourceLabel $folder.EffectiveConfig "issue_view_ignored_issues"}}</span>
                                </label>
                            </div>
                            {{end}}

                            <!-- Risk Score Threshold Override -->
                            {{with getEffectiveValue $folder.EffectiveConfig "risk_score_threshold"}}
                            <div class="form-group {{if isLocked $folder.EffectiveConfig "risk_score_threshold"}}field-locked{{end}}">
                                <label for="folder_{{$index}}_override_riskScoreThreshold">
                                    <span data-toggle="tooltip" title="Minimum risk score to display issues (0-1000)">Risk Score Threshold</span>
                                    {{if isLocked $folder.EffectiveConfig "risk_score_threshold"}}<span class="locked-indicator">Locked</span>{{end}}
                                    <span class="source-badge {{getSourceClass $folder.EffectiveConfig "risk_score_threshold"}}">{{getSourceLabel $folder.EffectiveConfig "risk_score_threshold"}}</span>
                                </label>
                                <input type="number" id="folder_{{$index}}_override_riskScoreThreshold" name="folder_{{$index}}_override_riskScoreThreshold" data-setting="risk_score_threshold" min="0" max="1000" value="{{.Value}}" {{if isLocked $folder.EffectiveConfig "risk_score_threshold"}}disabled{{end}}>
                            </div>
                            {{end}}

                            <button type="button" class="reset-overrides-btn" data-folder-index="{{$index}}" title="Reset all overrides for this folder to organization defaults">Reset to Organization Defaults</button>
                        </div>
                    </div>
                </div>
                {{end}}

                </div>
            </div>
                    {{end}}
                    {{else}}
                    <p>No {{.FolderLabel | toLower}}s configured. Open a workspace to configure {{.FolderLabel | toLower}}-specific settings.</p>
                    {{end}}
                </div>
            </div>
        </div>
    </form>

    <!-- Third-party libraries -->
    <script nonce="{{.Nonce}}">
        {{.JQuery}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.BootstrapJS}}
    </script>

    <!-- Core utilities and polyfills -->
    <script nonce="{{.Nonce}}">
        {{.Polyfills}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.Utils}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.Dom}}
    </script>

    <!-- State management -->
    <script nonce="{{.Nonce}}">
        {{.DirtyTracker}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.FormState}}
    </script>

    <!-- IDE integration -->
    <script nonce="{{.Nonce}}">
        {{.IdeBridge}}
    </script>

    <!-- UI modules -->
    <script nonce="{{.Nonce}}">
        {{.FormHandler}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.Tooltips}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.ResetHandler}}
    </script>

    <!-- Features -->
    <script nonce="{{.Nonce}}">
        {{.Validation}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.Folders}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.Authentication}}
    </script>
    <script nonce="{{.Nonce}}">
        {{.AutoSave}}
    </script>

    <!-- App initialization -->
    <script nonce="{{.Nonce}}">
        {{.App}}
    </script>
</body>
</html>
