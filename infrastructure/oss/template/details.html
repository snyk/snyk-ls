<!--
  ~ Â© 2024 Snyk Limited
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' ${cspSource}; style-src 'self' 'nonce-${nonce}' ${cspSource}; script-src 'nonce-${nonce}' ${cspSource};">

  <style nonce="${nonce}">
    .suggestion {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
    }

    .suggestion .suggestion-text {
      padding: 0.4rem 0;
      margin-bottom: 0.8rem;
      font-size: 1.8rem;
      font-weight: 500;
      line-height: 2.4rem;
    }

    .severity {
      display: flex;
      flex-direction: column;
      flex-grow: 0;
      float: left;
      margin: 0 1rem 0 0;
      text-align: center;
    }

    .severity .icon {
      width: 32px;
      height: 32px;
    }

    .icon {
      vertical-align: middle;
      width: 16px;
      height: 16px;
    }

    .identifiers {
      font-size: 1.3rem;
      line-height: 2rem;
    }

    /*TODO: move to vscode*/
    .vscode-dark .light-only {
      display: none;
    }

    .vscode-light .dark-only {
      display: none;
    }

    .learn {
      opacity: 0;
      height: 0;
      margin-top: 0;
      font-size: 1.3rem;
    }

    .learn.show {
      margin-top: 6px;
      opacity: 1;
      height: auto;
      transition-duration: 500ms;
      transition-property: height, opacity, margin-top;
    }

    .learn--link {
      margin-left: 3px;
    }

    .learn__code .learn--link {
    }

  </style>

  ${headerEnd}

  ${ideStyle}
</head>

<body>
<div class="suggestion">
  <section class="suggestion--header">
    <div class="severity">
      {{.SeverityIcon}}
    </div>
    <div class="suggestion-text">{{.IssueTitle}}</div>
    <div class="identifiers">
      {{.IssueType}}
      {{if gt (len .CVEs) 0}}
      <span class="delimiter"> </span>
      {{range $index, $cve := .CVEs}}
      <a class="cve styled-link" target="_blank" rel="noopener noreferrer"
         href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=$cve">{{$cve}}</a>
      {{if ne $index (idxMinusOne (len $.CVEs))}}<span class="delimiter"></span>{{end}}
      {{end}}
      {{end}}

      {{if gt (len .CWEs) 0}}
      <span class="delimiter"> </span>
      {{range $index, $cwe := .CWEs}}
      <a class="cwe styled-link" target="_blank" rel="noopener noreferrer"
         href="https://cwe.mitre.org/data/definitions/{{trimCWEPrefix $cwe}}.html">{{$cwe}}</a>
      {{if ne $index (idxMinusOne (len $.CWEs))}}<span class="delimiter"></span>{{end}}
      {{end}}
      {{end}}

      {{if gt (len .CvssScore) 0}}
      <span class="delimiter"> </span>
      <span>CVSS {{.CvssScore}}</span>
      {{end}}

      <span class="delimiter"> </span>
      <a class="styled-link" target="_blank" rel="noopener noreferrer"
         href="https://snyk.io/vuln/{{.IssueId}}">{{.IssueId}}</a>
    </div>
    {{ if .LessonUrl }}
      <div class="learn" id="learn">
        {{.LessonIcon}}
        <a class="learn--link" id="learn--link" href="{{.LessonUrl}}">Learn about this vulnerability</a>
      </div>
    {{end}}
  </section>
  <section class="delimiter-top summary">
    <div class="summary-item module">
      <div class="label font-light">Vulnerable module</div>
      <div class="content">{{.VulnerableModule}}</div>
    </div>
    <div class="summary-item introduced-through">
      <div class="label font-light">Introduced through</div>
      <div class="content">
        {{range $i, $element := .IntroducedThroughs}}
          <a href="{{$element.SnykUI}}/test/{{$element.PackageManager}}">{{$element.Module}}</a>
          {{ if lt $i (idxMinusOne (len $.IntroducedThroughs)) }}, {{end}}
        {{end}}
      </div>
    </div>
    <div class="summary-item fixed-in">
      <div class="label font-light">Fixed in</div>
      <div class="content">
        {{ if eq (len .FixedIn) 0 }}
        Not fixed
        {{else}}
        {{.IssueName}}@{{ join ", " .FixedIn }}
        {{end}}
      </div>
    </div>
    {{ if .ExploitMaturity }}
    <div class="summary-item maturity">
      <div class="label font-light">Exploit maturity</div>
      <div class="content">{{.ExploitMaturity}}</div>
    </div>
    {{end}}
  </section>
  <section class="delimiter-top summary">
    <h2>Detailed paths</h2>
    <div class="detailed-paths">
      {{range $i, $element := .DetailedPaths}}
        <div class="summary-item path {{ if gt $i 3 }}hidden{{end}}">
          <div class="label font-light">Introduced through</div>
          <div class="content">{{join " > " $element.From}}</div>
        </div>
        <div class="summary-item remediation {{ if gt $i 3 }}hidden{{end}}">
          <div class="label font-light">Remediation</div>
          <div class="content">{{$element.Remediation}}</div>
        </div>
      {{end}}
      {{ if gt .MoreDetailedPaths 0 }}
      <a id="more-detailed-paths--link">...and {{ .MoreDetailedPaths}} more</a>
      {{end}}
    </div>
  </section>
  <section class="delimiter-top">
    <div id="overview" class="vulnerability-overview">
      {{.IssueOverview}}
    </div>
  </section>
</div>
<script nonce="${nonce}">
  if (document.getElementById("learn--link")) {
    document.getElementById("learn").className = "learn show"
  }
  if (document.getElementById("more-detailed-paths--link")) {
    document.getElementById("more-detailed-paths--link").addEventListener('click', () => {
      const paths = document.getElementsByClassName("path");
      for(const path of paths) {
        path.classList.remove("hidden");
      }
      const remediations = document.getElementsByClassName("remediation")
      for(const remediation of remediations) {
        remediation.classList.remove("hidden");
      }
      document.getElementById("more-detailed-paths--link").classList.add("hidden");
    })
  }
</script>
</body>
</html>
